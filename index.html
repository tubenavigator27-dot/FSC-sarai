<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Focus Academy Admin Master</title>
    <style>
        :root {
            --primary: #4F46E5;
            --bg: #F8FAFC;
            --card-bg: #ffffff;
            --text: #0F172A;
            --danger: #EF4444;
            --success: #10B981;
            --gradient: linear-gradient(135deg, var(--primary), #9333EA);
        }
        body.dark-mode { --bg: #0F172A; --card-bg: #1E293B; --text: #F8FAFC; }
        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0; padding: 0; padding-bottom: 90px;
            user-select: none; transition: background 0.3s;
        }
        #login-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg); z-index: 2000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .role-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; width: 85%; margin: 20px 0; }
        .role-card { background: var(--card-bg); padding: 15px; border-radius: 12px; text-align: center; border: 2px solid transparent; cursor: pointer; }
        .role-card.selected { border-color: var(--primary); background: rgba(79, 70, 229, 0.1); }
        .login-input { padding: 15px; width: 80%; border-radius: 10px; border: 1px solid #ddd; margin-bottom: 10px; background: var(--card-bg); color: var(--text); }
        .page { display: none; padding: 20px; animation: fadeIn 0.3s; }
        .page.active { display: block; }
        header { background: var(--gradient); padding: 20px; color: white; border-radius: 0 0 25px 25px; display: flex; justify-content: space-between; align-items: center; }
        .grid-menu { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }
        .card { background: var(--card-bg); padding: 15px 5px; border-radius: 16px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.05); cursor: pointer; min-height: 100px; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .btn-submit { width: 100%; background: var(--gradient); color: white; border: none; padding: 15px; border-radius: 12px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .list-item { background: var(--card-bg); padding: 15px; border-radius: 12px; margin-bottom: 10px; border-left: 4px solid var(--primary); display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .btn-del { color: var(--danger); border: none; background: none; font-size: 18px; cursor: pointer; }
        
        /* STUDENT TOOLS */
        .progress-bar { background: #eee; border-radius: 10px; height: 10px; width: 100%; margin: 5px 0; overflow: hidden; }
        .progress-fill { background: var(--success); height: 100%; transition: 0.3s; }
        .timer-display { font-size: 40px; font-weight: bold; text-align: center; margin: 20px 0; }
        .quiz-opt { display: block; padding: 10px; background: #f1f5f9; margin: 5px 0; border-radius: 8px; color:#333; font-size: 14px; }
        
        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: var(--card-bg); display: flex; justify-content: space-around; padding: 12px 0; border-top: 1px solid #33333310; z-index: 1000; }
        .nav-icon { font-size: 24px; display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

    <div id="login-screen">
        <div style="font-size:50px;">ğŸ‘‘</div>
        <h2>Focus Academy</h2>
        <div class="role-grid">
            <div class="role-card selected" onclick="setRole('student', this)">ğŸ‘¨â€ğŸ“ Student</div>
            <div class="role-card" onclick="setRole('parent', this)">ğŸ‘ª Parent</div>
            <div class="role-card" onclick="setRole('teacher', this)">ğŸ‘¨â€ğŸ« Teacher</div>
            <div class="role-card" onclick="setRole('admin', this)">ğŸ¢ Admin</div>
        </div>
        <input type="text" id="username" class="login-input" placeholder="Name">
        <select id="user-class" class="login-input">
            <option value="">Select Class</option>
            <option value="6">Class 6</option><option value="7">Class 7</option><option value="8">Class 8</option>
            <option value="9">Class 9</option><option value="10">Class 10</option><option value="11">Class 11</option><option value="12">Class 12</option>
        </select>
        <input type="password" id="password" class="login-input" placeholder="Password" style="display:none;">
        <button class="btn-submit" style="width:80%;" onclick="login()">Login</button>
    </div>

    <div id="app-ui" style="display:none;">
        <header>
            <div>
                <h2 style="margin:0; font-size:18px;">Focus Academy</h2>
                <small id="header-info">--</small>
            </div>
            <button onclick="document.body.classList.toggle('dark-mode')" style="background:rgba(255,255,255,0.2); border:none; color:white; padding:5px; border-radius:5px;">ğŸŒ“</button>
        </header>

        <div id="dashboard" class="page active">
            <div id="notice-board"></div>
            <button id="admin-notice-btn" class="btn-submit" style="display:none;" onclick="addNotice()">+ Add Notice</button>
            <div id="menu-grid" class="grid-menu"></div>
        </div>

        <div id="quiz-page" class="page">
            <h2>ğŸ§  Class Quiz</h2>
            <div id="quiz-manage-box" style="display:none; background:#eef2ff; padding:15px; border-radius:10px; margin-bottom:15px;">
                <input id="new-q" placeholder="Question"><input id="q-o1" placeholder="Op 1"><input id="q-o2" placeholder="Op 2"><input id="q-o3" placeholder="Op 3"><input id="q-o4" placeholder="Op 4">
                <select id="q-ans" class="login-input"><option value="1">Ans: 1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option></select>
                <button class="btn-submit" onclick="addQuestion()">Add Question</button>
                <hr><h4>ğŸ“Š Submissions</h4><div id="quiz-results-list"></div>
            </div>
            <div id="quiz-list"></div>
            <button id="quiz-submit-btn" class="btn-submit" onclick="submitQuiz()">Submit</button>
        </div>

        <div id="chat-page" class="page">
            <h2>ğŸ’¬ Class Chat</h2>
            <div id="chat-disp" style="height:350px; background:#f0f0f0; border-radius:10px; overflow-y:scroll; padding:10px;"></div>
            <input id="chat-in" class="login-input" style="width:70%; margin-top:10px;" placeholder="Message..."><button class="btn-submit" style="width:25%;" onclick="sendMsg()">Send</button>
            <button id="admin-chat-clear" class="btn-submit" style="display:none; background:red;" onclick="clearChat()">ğŸ—‘ï¸ Clear All Chat</button>
        </div>

        <div id="leaderboard-page" class="page">
            <h2>ğŸ† Leaderboard</h2>
            <div id="lb-list"></div>
        </div>

        <div id="fee-page" class="page"><h2>ğŸ’° Fee Portal</h2><div class="card"><h3>Monthly Due: â‚¹ 2,500</h3><button class="btn-submit">Pay Now</button><button class="btn-submit" style="background:#333;">Download Receipt</button></div></div>
        
        <div id="study-tools-page" class="page">
            <h2>ğŸ“– Study Tools</h2>
            <div class="card" style="width:auto; padding:15px;">
                <div class="timer-display" id="timer-box">25:00</div>
                <button class="btn-submit" style="background:var(--success)" onclick="startTimer()">Start</button>
                <button class="btn-submit" style="background:var(--danger)" onclick="resetTimer()">Reset</button>
            </div>
        </div>

        <div id="gallery-page" class="page"><h2>ğŸ“¸ Gallery</h2><div class="card">Photos Coming Soon</div></div>
        <div id="qr-page" class="page"><h2>ğŸ”³ Digital ID</h2><img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=Focus" style="display:block; margin:auto;"></div>

        <div class="bottom-nav">
            <div class="nav-item" onclick="goHome()"><span class="nav-icon">ğŸ </span>Home</div>
            <div class="nav-item" id="nav-quiz-icon" onclick="nav('quiz-page')"><span class="nav-icon">ğŸ§ </span>Quiz</div>
            <div class="nav-item" onclick="nav('chat-page')"><span class="nav-icon">ğŸ’¬</span>Chat</div>
        </div>
    </div>

    <script>
        const db = {
            save: () => localStorage.setItem('focusMasterFinalDB', JSON.stringify(appData)),
            load: () => {
                const d = localStorage.getItem('focusMasterFinalDB');
                return d ? JSON.parse(d) : { classes: {} };
            }
        };

        let appData = db.load();
        let currentUser = { role: 'student', name: '', class: '' };
        let timerInterval;

        function setRole(r, el) {
            currentUser.role = r;
            document.querySelectorAll('.role-card').forEach(c => c.classList.remove('selected'));
            el.classList.add('selected');
            document.getElementById('password').style.display = (r==='admin' || r==='teacher') ? 'block' : 'none';
        }

        function login() {
            const n = document.getElementById('username').value;
            const c = document.getElementById('user-class').value;
            const p = document.getElementById('password').value;
            if(!n || !c) return alert("Fill Name & Class");
            if(currentUser.role==='admin' && p!=='1234') return alert("Wrong Admin Pass");
            if(currentUser.role==='teacher' && p!=='5678') return alert("Wrong Teacher Pass");

            currentUser.name = n; currentUser.class = c;
            if(!appData.classes[c]) appData.classes[c] = { notices: ["Welcome"], chats: [], quizzes: [], leaderboard: [], results: [] };

            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('app-ui').style.display = 'block';
            document.getElementById('header-info').innerText = `${currentUser.role.toUpperCase()} | Class ${c}`;

            // Admin/Teacher Specific UI
            if(currentUser.role==='admin' || currentUser.role==='teacher') {
                document.getElementById('quiz-manage-box').style.display = 'block';
                document.getElementById('admin-notice-btn').style.display = 'block';
                if(currentUser.role==='admin') document.getElementById('admin-chat-clear').style.display = 'block';
            }
            
            // Parent: Hide Quiz
            document.getElementById('nav-quiz-icon').style.display = (currentUser.role==='parent') ? 'none' : 'flex';

            renderDash();
        }

        function renderDash() {
            const grid = document.getElementById('menu-grid'); grid.innerHTML = '';
            let items = [
                {i:'ğŸ’¬', l:'Chat', f:"nav('chat-page')"},
                {i:'ğŸ†', l:'Leaders', f:"nav('leaderboard-page')"},
                {i:'ğŸ“¸', l:'Gallery', f:"nav('gallery-page')"},
                {i:'ğŸ”³', l:'ID Card', f:"nav('qr-page')"}
            ];
            if(currentUser.role==='parent') items.unshift({i:'ğŸ’°', l:'Fees', f:"nav('fee-page')"});
            if(currentUser.role==='student') {
                items.push({i:'ğŸ§ ', l:'Quiz', f:"nav('quiz-page')"}, {i:'ğŸ“–', l:'Tools', f:"nav('study-tools-page')"});
            }
            if(currentUser.role==='teacher') items.push({i:'ğŸ§ ', l:'Quiz', f:"nav('quiz-page')"});

            items.forEach(x => grid.innerHTML += `<div class="card" onclick="${x.f}"><span>${x.i}</span><b>${x.l}</b></div>`);

            let h = '';
            appData.classes[currentUser.class].notices.forEach((n,i) => {
                h += `<div class="list-item"><span>${n}</span> ${currentUser.role==='admin' ? `<button class="btn-del" onclick="delNote(${i})">ğŸ—‘ï¸</button>` : ''}</div>`;
            });
            document.getElementById('notice-board').innerHTML = h;
        }

        // ADMIN FEATURES
        function addNotice() {
            let t = prompt("Enter Notice Message:");
            if(t) { appData.classes[currentUser.class].notices.unshift(t); db.save(); renderDash(); }
        }
        function delNote(i) { appData.classes[currentUser.class].notices.splice(i,1); db.save(); renderDash(); }
        function clearChat() { if(confirm("Clear all messages?")) { appData.classes[currentUser.class].chats = []; db.save(); renderChat(); } }
        function delLB(i) { appData.classes[currentUser.class].leaderboard.splice(i,1); db.save(); renderLB(); }
        function delRes(i) { appData.classes[currentUser.class].results.splice(i,1); db.save(); renderQuizResults(); }

        // QUIZ
        function addQuestion() {
            let q = document.getElementById('new-q').value;
            let o = [document.getElementById('q-o1').value, document.getElementById('q-o2').value, document.getElementById('q-o3').value, document.getElementById('q-o4').value];
            let a = document.getElementById('q-ans').value;
            if(!q || o.includes("")) return alert("Fill all fields");
            appData.classes[currentUser.class].quizzes.push({q, o, a});
            db.save(); renderQuiz(); alert("Question Added!");
        }
        function renderQuiz() {
            let h = '';
            appData.classes[currentUser.class].quizzes.forEach((q, i) => {
                h += `<div class="list-item" style="display:block;"><b>Q${i+1}: ${q.q}</b>${q.o.map((opt, oi) => `<label class="quiz-opt"><input type="radio" name="q${i}" value="${oi+1}"> ${opt}</label>`).join('')} ${currentUser.role==='admin' ? `<button style="color:red; float:right;" onclick="delQuiz(${i})">Delete Q</button>` : ''}</div>`;
            });
            document.getElementById('quiz-list').innerHTML = h;
        }
        function delQuiz(i) { appData.classes[currentUser.class].quizzes.splice(i,1); db.save(); renderQuiz(); }

        function submitQuiz() {
            let score = 0, total = appData.classes[currentUser.class].quizzes.length;
            if(total===0) return alert("No quiz available");
            appData.classes[currentUser.class].quizzes.forEach((q, i) => {
                let sel = document.querySelector(`input[name="q${i}"]:checked`);
                if(sel && sel.value == q.a) score++;
            });
            let p = ((score/total)*100).toFixed(0);
            alert(`Result: ${score}/${total} (${p}%)`);
            appData.classes[currentUser.class].results.push({name: currentUser.name, score: `${score}/${total}`, p: p});
            let lb = appData.classes[currentUser.class].leaderboard;
            let uIdx = lb.findIndex(u => u.n === currentUser.name);
            if(uIdx > -1) { if(p > lb[uIdx].p) { lb[uIdx].p = p; } } else { lb.push({n: currentUser.name, p: p}); }
            lb.sort((a,b) => b.p - a.p); db.save();
        }

        function renderLB() {
            let h = '';
            appData.classes[currentUser.class].leaderboard.forEach((r, i) => {
                h += `<div class="list-item"><span>#${i+1} <b>${r.n}</b></span> <span><b>${r.p}%</b> ${currentUser.role==='admin' ? `<button onclick="delLB(${i})" style="margin-left:10px;">ğŸ—‘ï¸</button>` : ''}</span></div>`;
            });
            document.getElementById('lb-list').innerHTML = h || "No rankings yet.";
        }

        function renderQuizResults() {
            let h = '';
            (appData.classes[currentUser.class].results || []).reverse().forEach((r,i) => h += `<div class="list-item" style="font-size:11px;"><b>${r.name}</b>: ${r.score} (${r.p}%) ${currentUser.role==='admin' ? `<button onclick="delRes(${i})">ğŸ—‘ï¸</button>` : ''}</div>`);
            document.getElementById('quiz-results-list').innerHTML = h;
        }

        // CHAT
        function sendMsg() {
            let t = document.getElementById('chat-in').value; if(!t) return;
            appData.classes[currentUser.class].chats.push({n:currentUser.name, r:currentUser.role, t:t});
            db.save(); document.getElementById('chat-in').value=''; renderChat();
        }
        function renderChat() {
            let b = document.getElementById('chat-disp'); b.innerHTML='';
            appData.classes[currentUser.class].chats.forEach(m => {
                let me = m.n===currentUser.name;
                b.innerHTML += `<div style="background:${me?'var(--primary)':'white'}; color:${me?'white':'black'}; padding:8px; border-radius:8px; margin-bottom:5px; width:80%; margin-left:${me?'auto':'0'}; box-shadow:0 1px 2px rgba(0,0,0,0.1);"><b>${m.n}</b>: ${m.t}</div>`;
            });
            b.scrollTop = b.scrollHeight;
        }

        // UTILS
        function startTimer() { clearInterval(timerInterval); let time = 25*60; timerInterval = setInterval(()=>{ let m=Math.floor(time/60), s=time%60; document.getElementById('timer-box').innerText=`${m}:${s<10?'0':''}${s}`; if(time--<=0){clearInterval(timerInterval); alert("Time Up!");}}, 1000); }
        function resetTimer() { clearInterval(timerInterval); document.getElementById('timer-box').innerText="25:00"; }
        window.addEventListener('storage', () => { appData = db.load(); renderDash(); renderChat(); renderLB(); });
        function nav(p) { 
            document.querySelectorAll('.page').forEach(e => e.classList.remove('active')); 
            document.getElementById(p).classList.add('active'); 
            if(p==='chat-page') renderChat();
            if(p==='leaderboard-page') renderLB();
            if(p==='quiz-page' && currentUser.role!=='student') renderQuizResults();
            if(p==='quiz-page') renderQuiz();
        }
        function goHome() { nav('dashboard'); }
    </script>
</body>
</html>
